<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Code Reviewer - Choose Option</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="upload-write-page">
    <div class="options-container">
        <h1 class="website-name">Smart Code Reviewer</h1>
        
        <div class="options-grid">
            <div class="option-card" onclick="triggerFileUpload()">
                <div class="card-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                <h2>Upload Code</h2>
                <p>Upload any code file (.py, .js, .java, .cpp, .cs, etc.)</p>
            </div>
            
            <div class="option-card" onclick="goToEditor()">
                <div class="card-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                </div>
                <h2>Write Code</h2>
                <p>Write or paste your code in our VS Code-style editor</p>
            </div>
        </div>
        
        <input type="file" id="fileInput" accept=".py,.js,.java,.cpp,.c,.cs,.ts,.tsx,.jsx,.rb,.php,.swift,.go,.rs,.kt,.scala,.pl,.dart,.hs,.m,.r,.sql,.sh,.html,.css" style="display: none;" onchange="handleFileUpload(event)">
    </div>
    
    <div class="animated-bg">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>
    
    <script>
        function triggerFileUpload() {
            document.getElementById('fileInput').click();
        }
        
        function goToEditor() {
            window.location.href = '/editor';
        }
        
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                const code = e.target.result;
                
                if (!code || code.trim() === '') {
                    alert('The file is empty or corrupted. Please upload a valid code file.');
                    return;
                }
                
                const response = await fetch('/api/detect-language', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({code: code})
                });
                
                const data = await response.json();
                
                sessionStorage.setItem('uploadedCode', code);
                sessionStorage.setItem('detectedLanguage', data.language);
                
                window.location.href = '/editor';
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
